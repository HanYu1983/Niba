<html>

<head>
    <meta charset="UTF-8">
</head>
<style>
    .full {
        width: 100%;
        height: 100%;
        border: none;
    }
</style>

<body>
    <iframe id="laya" src="laya/layaIndex.html" class="full"></iframe>
</body>
<script>

    function callLaya(method, msg) {
        iframe.postMessage({
            method: method,
            msg: msg
        }, '*');
    }

    function receiveMessage(e) {
        // 來源網址（e.origin）不是指定的網域時
        // if (e.origin !== 'https://xxxxxxx.tw') {
        //     alert('資料來源錯誤');
        //     return false;
        // }
        // // 來源網址是指定的網域時
        // else {
        //     // 拿傳來的參數（e.data）
        //     const data = e.data;
        // }

        const data = e.data;

        const method = data.method;
        const msg = data.msg;

        switch (method) {
            case 'onLayaReady':
                console.log("laya準備完成");

                // 測試通知laya
                callLaya('init', 'hello');
                break;
        }
    }

    // 監聽 message 事件
    window.addEventListener('message', receiveMessage, false);

    var iframe = document.getElementById('laya').contentWindow;

</script>
<script>
    async function loadGundamCardInfo() {
        return import("./assets/GundamCard.json", { with: { type: "json" } }).then(json => {
            window.GundamCardInfos = json.default.data
        })
    }
    function getGundamCardInfo(imgID) {
        if (GundamCardInfos == null) {
            throw new Error(`GundamCardInfo not yet ready`)
        }
        return window.GundamCardInfos.find(info => info.imgID == imgID)
    }
    function clearGundamCardInfo(){
        delete window.GundamCardInfos
    }
</script>
<script>

    var socket = new WebSocket('ws://localhost:8081');

    socket.onopen = function (event) {
        console.log('已連接到WebSocket服務器');
        socket.send("PlayerB")
        console.log(getGundamCardInfo("179017_01A_U_BL013R_blue"))
    };

    socket.onmessage = function (event) {
        const flow = JSON.parse(event.data)
        console.log('收到消息: ', flow);
        // setTimeout(() => {
        //     socket.send(JSON.stringify(flow))
        // }, 3000)
    };

    socket.onerror = function (error) {
        console.log('WebSocket錯誤: ' + error);
    };

    socket.onclose = function (event) {
        console.log('WebSocket連接已關閉');
    };
</script>

</html>